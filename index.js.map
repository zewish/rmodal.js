{"version":3,"file":"index.js","sources":["src/rmodal.js"],"sourcesContent":["const is = (obj, type) => Object.prototype.toString.call(obj).toLowerCase() === `[object ${type}]`;\n\nconst addClass = (el, cls) => {\n    const arr = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c == cls);\n\n    if (!arr.length) {\n        el.className += ` ${cls}`;\n    }\n};\n\nconst removeClass = (el, cls) => {\n    el.className = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c != cls)\n    .join(' ');\n};\n\nclass RModal {\n    constructor(el, opts) {\n        this.opened = false;\n\n        this.opts = {\n            bodyClass: 'modal-open',\n            dialogClass: 'modal-dialog',\n            dialogOpenClass: 'bounceInDown',\n            dialogCloseClass: 'bounceOutUp',\n            focus: true,\n            focusElements: [\n                'a[href]', 'area[href]', 'input:not([disabled]):not([type=hidden])',\n                'button:not([disabled])', 'select:not([disabled])',\n                'textarea:not([disabled])', 'iframe', 'object', 'embed',\n                '*[tabindex]', '*[contenteditable]'\n            ],\n            escapeClose: true,\n            content: null,\n            closeTimeout: 500\n        };\n\n        Object.keys(opts || {})\n        .forEach((key) => {\n            /* istanbul ignore else */\n            if (opts[key] !== undefined) {\n                this.opts[key] = opts[key];\n            }\n        });\n\n        this.overlay = el;\n        this.dialog = el.querySelector(`.${this.opts.dialogClass}`);\n\n        if (this.opts.content) {\n            this.content(this.opts.content);\n        }\n    }\n\n    open(content) {\n        this.content(content);\n\n        if (!is(this.opts.beforeOpen, 'function')) {\n            return this._doOpen();\n        }\n\n        this.opts.beforeOpen(() => {\n            this._doOpen();\n        });\n    }\n\n    _doOpen() {\n        addClass(document.body, this.opts.bodyClass);\n\n        removeClass(this.dialog, this.opts.dialogCloseClass);\n        addClass(this.dialog, this.opts.dialogOpenClass);\n\n        this.overlay.style.display = 'block';\n\n        if (this.opts.focus) {\n            this.focusOutElement = document.activeElement;\n            this.focus();\n        }\n\n        if (is(this.opts.afterOpen, 'function')) {\n            this.opts.afterOpen();\n        }\n        this.opened = true;\n    }\n\n    close() {\n        if (!is(this.opts.beforeClose, 'function')) {\n            return this._doClose();\n        }\n\n        this.opts.beforeClose(() => {\n            this._doClose();\n        });\n    }\n\n    _doClose() {\n        removeClass(this.dialog, this.opts.dialogOpenClass);\n        addClass(this.dialog, this.opts.dialogCloseClass);\n\n        removeClass(document.body, this.opts.bodyClass);\n\n        if (this.opts.focus) {\n            this.focus(this.focusOutElement);\n        }\n\n        setTimeout(() => {\n            this.overlay.style.display = 'none';\n\n            if (is(this.opts.afterClose, 'function')) {\n                this.opts.afterClose();\n            }\n            this.opened = false;\n        }, this.opts.closeTimeout);\n    }\n\n    content(html) {\n        if (html === undefined) {\n            return this.dialog.innerHTML;\n        }\n\n        this.dialog.innerHTML = html;\n    }\n\n    elements(selector, fallback) {\n        fallback = fallback || window.navigator.appVersion.indexOf('MSIE 9.0') > -1;\n        selector = is(selector, 'array') ? selector.join(',') : selector;\n\n        return [].filter.call(\n            this.dialog.querySelectorAll(selector)\n            , (element) => {\n                if (fallback) {\n                    const style = window.getComputedStyle(element);\n                    return style.display !== 'none' && style.visibility !== 'hidden';\n                }\n\n                return element.offsetParent !== null;\n            }\n        );\n    }\n\n    focus(el) {\n        el = el || this.elements(this.opts.focusElements)[0] || this.dialog.firstChild;\n\n        if (el && is(el.focus, 'function')) {\n            el.focus();\n        }\n    }\n\n    keydown(ev) {\n        if (this.opts.escapeClose && ev.which == 27) {\n            this.close();\n        }\n\n        const stopEvent = () => {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n\n        if (this.opened && ev.which == 9 && this.dialog.contains(ev.target)) {\n            const elements = this.elements(this.opts.focusElements),\n                first = elements[0],\n                last = elements[elements.length - 1];\n\n            if (first == last) {\n                stopEvent();\n            }\n            else if (ev.target == first && ev.shiftKey) {\n                stopEvent();\n                last.focus();\n            }\n            else if (ev.target == last && !ev.shiftKey) {\n                stopEvent();\n                first.focus();\n            }\n        }\n    }\n}\n\nRModal.prototype.version = '@@VERSION@@';\nRModal.version = '@@VERSION@@';\n\nexport default RModal;\n"],"names":["const","this"],"mappings":"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"}