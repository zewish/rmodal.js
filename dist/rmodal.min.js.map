{"version":3,"file":"rmodal.min.js","sources":["../src/rmodal.js"],"sourcesContent":["const is = (obj, type) => Object.prototype.toString.call(obj).toLowerCase() === `[object ${type}]`;\n\nconst addClass = (el, cls) => {\n    const arr = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c == cls);\n\n    if (!arr.length) {\n        el.className += ` ${cls}`;\n    }\n};\n\nconst removeClass = (el, cls) => {\n    el.className = el.className\n    .split(/\\s+/)\n    .filter((c) => !!c && c != cls)\n    .join(' ');\n};\n\nclass RModal {\n    constructor(el, opts) {\n        this.opened = false;\n\n        this.opts = {\n            bodyClass: 'modal-open',\n            dialogClass: 'modal-dialog',\n            dialogOpenClass: 'bounceInDown',\n            dialogCloseClass: 'bounceOutUp',\n            focus: true,\n            focusElements: [\n                'a[href]', 'area[href]', 'input:not([disabled]):not([type=hidden])',\n                'button:not([disabled])', 'select:not([disabled])',\n                'textarea:not([disabled])', 'iframe', 'object', 'embed',\n                '*[tabindex]', '*[contenteditable]'\n            ],\n            escapeClose: true,\n            content: null,\n            closeTimeout: 500\n        };\n\n        Object.keys(opts || {})\n        .forEach((key) => {\n            /* istanbul ignore else */\n            if (opts[key] !== undefined) {\n                this.opts[key] = opts[key];\n            }\n        });\n\n        this.overlay = el;\n        this.dialog = el.querySelector(`.${this.opts.dialogClass}`);\n\n        if (this.opts.content) {\n            this.content(this.opts.content);\n        }\n    }\n\n    open(content) {\n        this.content(content);\n\n        if (!is(this.opts.beforeOpen, 'function')) {\n            return this._doOpen();\n        }\n\n        this.opts.beforeOpen(() => {\n            this._doOpen();\n        });\n    }\n\n    _doOpen() {\n        addClass(document.body, this.opts.bodyClass);\n\n        removeClass(this.dialog, this.opts.dialogCloseClass);\n        addClass(this.dialog, this.opts.dialogOpenClass);\n\n        this.overlay.style.display = 'block';\n\n        if (this.opts.focus) {\n            this.focusOutElement = document.activeElement;\n            this.focus();\n        }\n\n        if (is(this.opts.afterOpen, 'function')) {\n            this.opts.afterOpen();\n        }\n        this.opened = true;\n    }\n\n    close() {\n        if (!is(this.opts.beforeClose, 'function')) {\n            return this._doClose();\n        }\n\n        this.opts.beforeClose(() => {\n            this._doClose();\n        });\n    }\n\n    _doClose() {\n        removeClass(this.dialog, this.opts.dialogOpenClass);\n        addClass(this.dialog, this.opts.dialogCloseClass);\n\n        removeClass(document.body, this.opts.bodyClass);\n\n        if (this.opts.focus) {\n            this.focus(this.focusOutElement);\n        }\n\n        setTimeout(() => {\n            this.overlay.style.display = 'none';\n\n            if (is(this.opts.afterClose, 'function')) {\n                this.opts.afterClose();\n            }\n            this.opened = false;\n        }, this.opts.closeTimeout);\n    }\n\n    content(html) {\n        if (html === undefined) {\n            return this.dialog.innerHTML;\n        }\n\n        this.dialog.innerHTML = html;\n    }\n\n    elements(selector, fallback) {\n        fallback = fallback || window.navigator.appVersion.indexOf('MSIE 9.0') > -1;\n        selector = is(selector, 'array') ? selector.join(',') : selector;\n\n        return [].filter.call(\n            this.dialog.querySelectorAll(selector)\n            , (element) => {\n                if (fallback) {\n                    const style = window.getComputedStyle(element);\n                    return style.display !== 'none' && style.visibility !== 'hidden';\n                }\n\n                return element.offsetParent !== null;\n            }\n        );\n    }\n\n    focus(el) {\n        el = el || this.elements(this.opts.focusElements)[0] || this.dialog.firstChild;\n\n        if (el && is(el.focus, 'function')) {\n            el.focus();\n        }\n    }\n\n    keydown(ev) {\n        if (this.opts.escapeClose && ev.which == 27) {\n            this.close();\n        }\n\n        const stopEvent = () => {\n            ev.preventDefault();\n            ev.stopPropagation();\n        }\n\n        if (this.opened && ev.which == 9 && this.dialog.contains(ev.target)) {\n            const elements = this.elements(this.opts.focusElements),\n                first = elements[0],\n                last = elements[elements.length - 1];\n\n            if (first == last) {\n                stopEvent();\n            }\n            else if (ev.target == first && ev.shiftKey) {\n                stopEvent();\n                last.focus();\n            }\n            else if (ev.target == last && !ev.shiftKey) {\n                stopEvent();\n                first.focus();\n            }\n        }\n    }\n}\n\nRModal.prototype.version = '@@VERSION@@';\nRModal.version = '@@VERSION@@';\n\nexport default RModal;\n"],"names":["is","obj","type","Object","prototype","toString","call","toLowerCase","addClass","el","cls","className","split","filter","c","length","removeClass","join","RModal","opts","this","opened","bodyClass","dialogClass","dialogOpenClass","dialogCloseClass","focus","focusElements","escapeClose","content","closeTimeout","keys","forEach","key","undefined","this$1","overlay","dialog","querySelector","open","beforeOpen","_doOpen","document","body","style","display","focusOutElement","activeElement","afterOpen","close","beforeClose","_doClose","setTimeout","afterClose","html","innerHTML","elements","selector","fallback","window","navigator","appVersion","indexOf","querySelectorAll","element","getComputedStyle","visibility","offsetParent","firstChild","keydown","ev","which","stopEvent","preventDefault","stopPropagation","contains","target","const","first","last","shiftKey","version"],"mappings":"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"}